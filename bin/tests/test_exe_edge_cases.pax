module exe test_exe_edge_cases;

// Test edge cases and corner cases

routine printf(const fmt: pointer to char; ...): int32; external 'msvcrt.dll';

(* 
   Test block comments
   This is a multi-line block comment
   using (* ... *) syntax
*)

var
  a: int32;
  b: int32;
  c: int32;
  result: int32;
  flag: bool;
  arr: array[-5..5] of int32;
  i: int32;

(* Another block comment on single line *)

begin
  printf('=== Edge Cases Test ===\n\n');
  
  // Test 1: Empty statements (standalone semicolons)
  printf('Test 1: Empty statements\n');
  ;
  ;;
  printf('  Empty statements parsed correctly\n');
  ;
  
  // Test 2: Block comments already tested by compilation
  printf('\nTest 2: Block comments\n');
  printf('  (* ... *) block comments work\n');
  
  (* inline block comment *) printf('  Inline block comment works\n');
  
  // Test 3: Deeply nested expressions
  printf('\nTest 3: Deeply nested expressions\n');
  a := 2;
  b := 3;
  c := 4;
  
  // Complex precedence
  result := ((a + b) * c - (b * a)) + ((c - a) * (b + 1));
  printf('  ((2+3)*4 - (3*2)) + ((4-2)*(3+1)) = %d (expect 22)\n', result);
  
  // Nested comparisons
  flag := ((a < b) and (b < c)) or ((c > a) and not (a = b));
  if flag then
    printf('  Complex boolean expression = true\n');
  
  // Deep nesting
  result := (((((a + 1) * 2) - 3) + 4) * 5);
  printf('  (((((2+1)*2)-3)+4)*5) = %d (expect 35)\n', result);
  
  // Test 4: Negative array index ranges
  printf('\nTest 4: Negative array indices\n');
  
  // Initialize array with negative indices
  for i := -5 to 5 do
  begin
    arr[i] := i * 10;
  end;
  
  printf('  arr[-5] = %d (expect -50)\n', arr[-5]);
  printf('  arr[0] = %d (expect 0)\n', arr[0]);
  printf('  arr[5] = %d (expect 50)\n', arr[5]);
  printf('  arr[-3] = %d (expect -30)\n', arr[-3]);
  printf('  arr[3] = %d (expect 30)\n', arr[3]);
  
  // Test 5: Multiple variable operations
  printf('\nTest 5: Chained assignments via expressions\n');
  a := 1;
  b := a + 1;
  c := b + 1;
  result := a + b + c;
  printf('  a=1, b=a+1=2, c=b+1=3, sum = %d (expect 6)\n', result);
  
  // Test 6: Mixed operators precedence
  printf('\nTest 6: Operator precedence\n');
  result := 2 + 3 * 4;
  printf('  2 + 3 * 4 = %d (expect 14)\n', result);
  
  result := (2 + 3) * 4;
  printf('  (2 + 3) * 4 = %d (expect 20)\n', result);
  
  result := 10 - 6 - 2;
  printf('  10 - 6 - 2 = %d (expect 2, left assoc)\n', result);
  
  result := 10 / 2 / 2;
  printf('  10 / 2 / 2 = %d (expect 2, left assoc)\n', result);
  
  // Test 7: Unary operators
  printf('\nTest 7: Unary operators\n');
  a := 5;
  result := -a;
  printf('  -5 = %d\n', result);
  
  result := --a;  // double negative
  printf('  --5 = %d (expect 5)\n', result);
  
  flag := true;
  if not flag then
    printf('  ERROR: not true should be false\n')
  else
    printf('  not true = false (correct)\n');
  
  if not not flag then
    printf('  not not true = true (correct)\n');
  
  printf('\n=== All Edge Case Tests Passed ===\n');
end.
