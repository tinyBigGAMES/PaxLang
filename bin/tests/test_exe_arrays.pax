// Test: Static and Dynamic Arrays
module exe test_exe_arrays;

routine printf(const fmt: pointer to char; ...): int32; external 'msvcrt.dll';

type
  TIntArray = array of int32;
  TFixedArray = array[0..9] of int32;
  TMatrix = array[0..2] of array[0..2] of int32;
  TInt64Array = array of int64;

var
  // Static arrays
  fixed: TFixedArray;
  matrix: TMatrix;
  nums: array[0..4] of int32;
  
  // Dynamic arrays
  dyn: TIntArray;
  data: TInt64Array;
  
  i: int32;
  sum: int32;

begin
  printf('=== Static Arrays Test ===\n');
  
  // Static array access
  fixed[0] := 10;
  fixed[1] := 20;
  fixed[2] := 30;
  sum := fixed[0] + fixed[1] + fixed[2];
  printf('fixed[0]+fixed[1]+fixed[2] = %d\n', sum);
  
  // Initialize with loop
  for i := 0 to 9 do
    fixed[i] := i * 10;
  end;
  
  // Sum array
  sum := 0;
  for i := 0 to 9 do
    sum := sum + fixed[i];
  end;
  printf('Sum of fixed[0..9] = %d\n', sum);
  
  // Matrix (2D array)
  matrix[0][0] := 1;
  matrix[0][1] := 2;
  matrix[0][2] := 3;
  matrix[1][0] := 4;
  matrix[1][1] := 5;
  matrix[1][2] := 6;
  matrix[2][0] := 7;
  matrix[2][1] := 8;
  matrix[2][2] := 9;
  printf('matrix[1][1] = %d\n', matrix[1][1]);
  
  // Inline static array
  nums[0] := 1;
  nums[1] := 2;
  nums[2] := 3;
  nums[3] := 4;
  nums[4] := 5;
  sum := nums[0] + nums[4];
  printf('nums[0]+nums[4] = %d\n', sum);
  
  printf('\n=== Dynamic Arrays Test ===\n');
  
  // Allocate dynamic array
  setlength(dyn, 5);
  printf('After setlength(dyn, 5): len = %lld\n', len(dyn));
  
  // Fill array
  dyn[0] := 100;
  dyn[1] := 200;
  dyn[2] := 300;
  dyn[3] := 400;
  dyn[4] := 500;
  printf('dyn[0]=%d, dyn[4]=%d\n', dyn[0], dyn[4]);
  
  // Sum array
  sum := 0;
  for i := 0 to 4 do
    sum := sum + dyn[i];
  end;
  printf('Sum of dyn = %d\n', sum);
  
  // Resize
  setlength(dyn, 10);
  printf('After setlength(dyn, 10): len = %lld\n', len(dyn));
  dyn[5] := 600;
  printf('dyn[5] = %d\n', dyn[5]);
  
  // Int64 dynamic array
  setlength(data, 3);
  data[0] := 1000000000;
  data[1] := 2000000000;
  data[2] := 3000000000;
  printf('len(data) = %lld\n', len(data));
  printf('data[2] = %lld\n', data[2]);
  
  printf('\nArrays test passed!\n');
end.
